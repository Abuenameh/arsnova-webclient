<mat-toolbar class="mat-elevation-z2">
  <ng-template #focusModeHeader>
    <mat-toolbar-row fxLayout="row" fxLayoutAlign="space-between center">
      <span class="focus-mode-hint">{{
        'focus-mode.presenter-controls-app' | transloco
      }}</span>
      <button
        mat-icon-button
        (click)="leaveRoom()"
        [matTooltip]="'focus-mode.leave-room' | transloco"
      >
        <mat-icon color="warn">exit_to_app</mat-icon>
      </button>
    </mat-toolbar-row>
  </ng-template>
  <mat-toolbar-row
    *ngIf="
      !room?.focusModeEnabled || !hasRole(UserRole.PARTICIPANT);
      else focusModeHeader
    "
  >
    <button
      id="back-button"
      mat-icon-button
      aria-labelledby="back-label"
      *ngIf="router.url !== '/'"
      (click)="goBack()"
      appHotkey="0"
      matTooltip="{{ 'header.back' | transloco }}"
    >
      <mat-icon class="header-icons">arrow_back</mat-icon>
    </button>
    <lib-extension-point
      extensionId="branding-logo"
      [extensionData]="{ headerPlacement: true }"
      *ngIf="router.url === '/'"
    ></lib-extension-point>
    <span class="fill-remaining-space"></span>

    <mat-menu
      id="user-menu"
      #userMenu="matMenu"
      [overlapTrigger]="false"
      xPosition="before"
    >
      <button
        id="my-rooms-button"
        mat-menu-item
        *ngIf="auth"
        (click)="navToUserHome()"
        tabindex="0"
      >
        <mat-icon color="primary">home</mat-icon>
        <span>{{ 'header.my-rooms' | transloco }}</span>
      </button>
      <button
        id="login-button"
        *ngIf="isGuest()"
        mat-menu-item
        (click)="navToLogin()"
      >
        <mat-icon color="primary">exit_to_app</mat-icon>
        <span>{{ 'header.login' | transloco }}</span>
      </button>
      <a
        id="help-button"
        *ngIf="helpUrl"
        [attr.href]="helpUrl"
        target="_blank"
        mat-menu-item
      >
        <mat-icon>help</mat-icon>
        <span>{{ 'header.help' | transloco }}</span>
      </a>
      <button
        id="theme-switcher"
        mat-menu-item
        (click)="toggleTheme()"
        appTrackInteraction="Theme switched"
        [appTrackName]="currentTheme"
      >
        <mat-icon>{{
          currentTheme === 'light' ? 'dark_mode' : 'light_mode'
        }}</mat-icon>
        <span>{{
          (currentTheme === 'light' ? 'header.dark-mode' : 'header.light-mode')
            | transloco
        }}</span>
      </button>
      <button id="language-menu" mat-menu-item [matMenuTriggerFor]="langMenu">
        <mat-icon>language</mat-icon>
        <span>{{ 'header.language' | transloco }}</span>
      </button>
      <div *ngIf="deviceWidth < 1000">
        <button
          id="privacy-button"
          mat-menu-item
          [matMenuTriggerFor]="privacyMenu"
        >
          <mat-icon>security</mat-icon>
          <span>{{ 'footer.dsgvo' | transloco }}</span>
        </button>
        <a
          id="imprint-button"
          *ngIf="imprintUrl"
          [attr.href]="imprintUrl"
          target="_blank"
          mat-menu-item
        >
          <mat-icon>contact_mail</mat-icon>
          <span>{{ 'footer.imprint' | transloco }}</span>
        </a>
      </div>
      <button
        id="admin-button"
        mat-menu-item
        *ngIf="isAdmin()"
        routerLink="/admin"
      >
        <mat-icon>build</mat-icon>
        <span>{{ 'header.admin-area' | transloco }}</span>
      </button>
      <button
        id="templates-button"
        mat-menu-item
        *ngIf="auth && contentGroupTemplatesActive"
        (click)="navToTemplates()"
      >
        <mat-icon>text_snippet</mat-icon>
        <span>{{ 'header.public-templates' | transloco }}</span>
      </button>
      <button
        id="user-profile-button"
        mat-menu-item
        *ngIf="auth"
        (click)="navToProfile()"
      >
        <mat-icon>account_box</mat-icon>
        <span>{{ 'header.user-profile' | transloco }}</span>
      </button>
      <button
        id="logout-button"
        *ngIf="auth && !isGuest()"
        mat-menu-item
        (click)="logout()"
      >
        <mat-icon color="warn">exit_to_app</mat-icon>
        <span>{{ 'header.logout' | transloco }}</span>
      </button>
    </mat-menu>

    <mat-menu #langMenu="matMenu" xPosition="before" [overlapTrigger]="false">
      <button
        *ngFor="let lang of langs"
        mat-menu-item
        (click)="changeLanguage(lang)"
        appTrackInteraction="Language switched"
        [appTrackName]="lang.key"
      >
        <span [ngClass]="{ 'selected-menu-item': currentLang === lang.key }">{{
          lang.name
        }}</span>
      </button>
      <div *ngIf="translateUrl">
        <mat-divider></mat-divider>
        <a
          id="translation-server-button"
          [attr.href]="translateUrl"
          target="_blank"
          mat-menu-item
        >
          <mat-icon>translate</mat-icon>
          <span>{{ 'header.add-translation' | transloco }}</span>
        </a>
      </div>
    </mat-menu>

    <mat-menu #privacyMenu="matMenu" [overlapTrigger]="false">
      <a
        *ngIf="privacyUrl"
        [attr.href]="privacyUrl"
        target="_blank"
        mat-menu-item
      >
        {{ 'footer.privacy-policy' | transloco }}</a
      >
      <button mat-menu-item (click)="showCookieSettings()">
        {{ 'footer.cookie-settings' | transloco }}
      </button>
    </mat-menu>

    <div fxLayout="row" fxLayoutAlign="start center">
      <div *ngIf="!!role && !hasRole(UserRole.PARTICIPANT)">
        <div fxLayout="row" fxLayoutGap="10px" class="desktop-action-container">
          <button
            mat-button
            color="{{ isPreview ? 'primary' : '' }}"
            (click)="switchRole()"
            aria-labelledby="switch-role"
          >
            <mat-icon>{{ isPreview ? 'edit' : 'preview' }}</mat-icon>
            {{
              (isPreview ? 'header.editing-view' : 'header.preview') | transloco
            }}
          </button>
          <button
            *ngIf="hasRole(UserRole.OWNER) || hasRole(UserRole.EDITOR)"
            [disabled]="isPreview"
            mat-button
            (click)="goToSettings()"
          >
            <mat-icon>settings</mat-icon>
            {{ 'header.room-settings' | transloco }}
          </button>
          <button
            *ngIf="hasRole(UserRole.OWNER) || hasRole(UserRole.EDITOR)"
            [disabled]="isPreview"
            mat-raised-button
            color="primary"
            [matMenuTriggerFor]="
              openPresentationDirectly ? hideMenu : presentationMenu
            "
            (click)="presentCurrentView()"
          >
            <mat-icon>present_to_all</mat-icon>
            {{ 'header.present' | transloco }}
          </button>
          <mat-menu class="visually-hidden" #hideMenu="matMenu"></mat-menu>
        </div>
        <div class="mobile-action-container">
          <button
            *ngIf="!isPreview"
            mat-icon-button
            [matMenuTriggerFor]="roomMenu"
          >
            <mat-icon>more_vert</mat-icon>
          </button>
          <button
            *ngIf="isPreview"
            mat-icon-button
            color="primary"
            (click)="switchRole()"
            aria-labelledby="switch-role"
          >
            <mat-icon>edit</mat-icon>
          </button>
        </div>
        <mat-menu #roomMenu="matMenu">
          <button
            mat-menu-item
            tabindex="0"
            (click)="switchRole()"
            aria-labelledby="switch-role"
          >
            <mat-icon>preview</mat-icon>
            {{ 'header.preview' | transloco }}
          </button>
          <button
            *ngIf="hasRole(UserRole.OWNER)"
            mat-menu-item
            tabindex="0"
            (click)="goToSettings()"
          >
            <mat-icon>settings</mat-icon>
            <span>{{ 'header.room-settings' | transloco }}</span>
          </button>
        </mat-menu>
      </div>
      <mat-menu #presentationMenu="matMenu">
        <button mat-menu-item tabindex="0" (click)="presentCurrentView(true)">
          <mat-icon class="menu-icon">personal_video</mat-icon>
          <span>{{ 'header.presentation-mode' | transloco }}</span>
        </button>
        <lib-extension-point
          extensionId="present-in-new-tab"
          (extensionEvent)="checkIfOpenPresentationDirectly($event)"
        ></lib-extension-point>
      </mat-menu>
      <div fxLayoutGap="16px" fxLayoutAlign="center center">
        <button
          *ngIf="announcementState"
          mat-icon-button
          (click)="showNews()"
          class="icon-badge"
          [matTooltip]="
            (announcementState.new > 0
              ? 'announcement.new-announcements'
              : 'announcement.announcements'
            ) | transloco
          "
          matBadge="{{ announcementState.new }}"
          matBadgeColor="accent"
          [matBadgeHidden]="announcementState.new === 0"
          appHotkey="a"
        >
          <mat-icon> notifications </mat-icon>
        </button>
        <button
          mat-icon-button
          class="user-button primary-variant"
          [matMenuTriggerFor]="userMenu"
          aria-labelledby="room-label"
          id="menu-button"
          appHotkey="9"
          [appHotkeyTitle]="'header.menu' | transloco"
          [ngClass]="{ guest: isGuest() }"
          fxLayoutAlign="center center"
        >
          <mat-icon *ngIf="isGuest()">person_outline</mat-icon>
          <span *ngIf="!isGuest()">{{ userCharacter }}</span>
        </button>
      </div>
    </div>
  </mat-toolbar-row>
</mat-toolbar>

<div class="visually-hidden">
  <div id="back-label">{{ 'header.a11y-back' | transloco }}</div>
  <div id="room-label">{{ 'header.a11y-room' | transloco }}</div>
  <div id="switch-role">
    {{
      (isPreview ? 'header.a11y-switch-back' : 'header.a11y-switch-role')
        | transloco
    }}
  </div>
</div>
